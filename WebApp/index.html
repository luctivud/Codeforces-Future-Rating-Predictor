<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CF Rating Predictor</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" integrity="undefined" crossorigin="anonymous">
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.min.js" integrity="undefined" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="undefined" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.esm.min.js" integrity="undefined" crossorigin="anonymous"></script> -->
    <script src="https://code.iconify.design/1/1.0.7/iconify.min.js"></script> <!-- codeforces icon-->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href='https://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet'>
    <link href="https://fonts.googleapis.com/css2?family=Balthazar&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="magic.css/dist/magic.css">
    <style>
        :root {
            --BGPRIMYUD: #101010;
            /* --BGPRIMYUD: #fff; */
            --BGSECCYUD: #ffa620;
            --FGPRIMYUD: #ffffff;
            --GRADPRIMYUD: #ffa620;
            --GRADSECCYUD: #fba11a;
        }
        body {
            font-family: 'Montserrat';
            /* color: black; */
            color: white;
            font-size: 1rem;
        }
        .bg-primyud {
            background-color: var(--BGPRIMYUD);
            color: white;
            /* color: black; */
        }
        .bg-seccyud {
            background-color: var(--BGSECCYUD);
        }
        .navbar-brand {
            font-family: 'Balthazar', serif;
            font-size: 2.4rem;
        }
        .tapered {
            background-image: linear-gradient(179deg,rgb(254, 97, 158) 0%, rgb(254, 97, 158) 50%,transparent 54%, transparent 100%);
        }

        .tapered2 {
            background-image: linear-gradient(181deg, var(--GRADPRIMYUD) 0%, var(--GRADSECCYUD) 50%, transparent 54%, transparent 100%);
        }
        nav {
            margin-bottom: 2.5rem;
        }
        nav a {
            /* color: black; */
            color: white;
            background-size: 100% 15%;
            background-repeat: repeat-x;
            background-position: left 0% bottom 10%;
        }
        nav a :hover {
            color: white;
        }
        nav a span :hover {
            background-color: blue;
        }
        .form-control:focus {
            border-color: var(--BGSECCYUD);  box-shadow: none; -webkit-box-shadow: none;
        } 
        .rating-predicted-class {
            font-size: 200%;
            font-weight: 700;
            letter-spacing: .4em;
        }
    </style>
</head>

    
<body class="bg-primyud">
    <!-- Header for page here -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primyud">
        <a class="navbar-brand mx-auto tapered2" href="#"> 
            <span class="iconify" data-icon="simple-icons:codeforces" data-inline="false"></span> 
            <!-- <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24" class="iconify" data-icon="simple-icons:codeforces" data-inline="false" style="transform: rotate(360deg);">
                <path d="M4.5 7.5A1.5 1.5 0 0 1 6 9v10.5A1.5 1.5 0 0 1 4.5 21h-3C.673 21 0 20.328 0 
                19.5V9c0-.828.673-1.5 1.5-1.5h3zm9-4.5A1.5 1.5 0 0 1 15 4.5v15a1.5 1.5 0 0 1-1.5 1.5h-3c-.827 
                0-1.5-.672-1.5-1.5v-15c0-.828.673-1.5 1.5-1.5h3zm9 7.5A1.5 1.5 0 0 1 24 12v7.5a1.5 1.5 0 0 1-1.5 
                1.5h-3a1.5 1.5 0 0 1-1.5-1.5V12a1.5 1.5 0 0 1 1.5-1.5h3z" fill="blue"></path>
            </svg> -->
            CodeForces Future Rating Predictor 
        </a>
    </nav>
    
    <!-- / Header for page here -->
    <!-- User enter details here -->
    <div class="container-fluid bg-primyud">
        <div class="row d-flex">
            <div class="col-md-12 mx-auto bg-primyud">
                <form>
                    <div class="form-group col-md-4 mx-auto pb-2">
                        <label for="max-rating">Enter your max and current ratings</label>
                        <input type="text" class="form-control mb-2" id="curr-rating" placeholder="Current Rating">
                        <input type="text" class="form-control mb-2" id="max-rating" placeholder="Max Rating">
                    </div>
                    <div class="form-group col-md-4 mx-auto pb-4">
                        <label for="delta-1">Enter deltas from past 3 rounds</label>
                        <div class="row">
                            <div class="col-md-4">
                                <input type="text" class="form-control" name = "delta-arr" id="delta-1" placeholder="Delta 1">
                            </div>
                            <div class="col-md-4">
                                <input type="text" class="form-control" name = "delta-arr" id="delta-2" placeholder="Delta 2">
                            </div>
                            <div class="col-md-4">                            
                                <input type="text" class="form-control" name = "delta-arr" id="delta-3" placeholder="Delta 3">
                            </div>
                        </div>
                    </div>
                    <div class="form-group col-md-4 mx-auto pb-4">
                        <label for="lucky-number">Enter your lucky number</label>
                        <input type="text" class="form-control" id="lucky-number" placeholder="Lucky Number">
                    </div>
                    <div type = "button" class="btn bg-seccyud col-md-4 d-flex mx-auto justify-content-center mb-2" onclick="getPredictedRatings()">Predict Ratings</div>
                    <div class="col-md-4 mx-auto pb-2 text-center" id = "warning-generated"> </div>
                    <div class="col-md-4 mx-auto pb-2 text-center" id = "predicted-ratings"> </div>
                    <div class="col-md-4 mx-auto pb-2 text-center" id = "additional-things"> </div>
                </form>
            </div>
        </div>
    </div>
    <!-- / User enter details here -->
    <!-- Footer for page here -->

    <!-- / Footer for page here -->
</body>
<script>
    const SEED_ACCEPTANCE_LT = 10;
    const MULT_ACCEPTANCE_LT = 301;
    const COUNT_PREV_CONTEST_DELTA = 3;
    const MULTIPLIER = 10;
    const UPP_LIM_FOR_MUL = 1000;
    const MAX_RATING_SO_FAR = 3797;
    const MY_FAV_REDUCING_AGENT = -3;
    
    // 12
    var currRank = -1;
    const title_on_rating = [
        "Undated",
        "Noobie", 
        "Puppy-lil", "Spicy-list", "Eggs-puff",
        "Candyman-Disaster", "Maatsaab", "Entertainment-Mstrbator", 
        "Grandma's Sister", "Indigenous Gangbastad", "Legendary Grandma",
        "Insanity"
    ];

    const ratings_list = [
        1, 
        1200, 1400, 1600, 
        1900, 2100, 2300, 
        2400, 2600, 3000, MAX_RATING_SO_FAR+1, 
        10000
    ];


    function warn(message) {

    }


    function generate_error(message) {
        document.getElementById("warning-generated").innerHTML = "<span class = \"error-msg\">";
        document.getElementById("warning-generated").innerHTML += message;
        document.getElementById("warning-generated").innerHTML += "</span>";
    }


    function validate_input(maxRating, currRating, prev_rating_deltas) {
        if (maxRating === NaN) {
            currRank = -1;
            generate_error("Your max rating is NaN.");
            return false;
        } else if (currRating === NaN) {
            currRank = -1;
            generate_error("Your current rating is NaN.");
            return false;
        }

        for (var i = 0; i < 12; i++) {
            if (ratings_list[i] > currRating) {
                currRank = i;
                break;
            }
        }
        if ((maxRating > currRating) || (maxRating > MAX_RATING_SO_FAR)) {
            currRank = -1;
            if (maxRating > currRating) {
                generate_error("Your max rating is greater than current rating.");
            } else {
                generate_error("You have insanely high rating.. You broke my code.. bich!");
            }
            return false;
        }
        return true;
    }


    function normalize_deltas(prev_rating_deltas) {
        var rainboy_flag = true;
        for (var i = 0; i < COUNT_PREV_CONTEST_DELTA; i++) {
            rainboy_flag &= (Math.abs(prev_rating_deltas[i]) >= 80);
        }

        if (rainboy_flag) warn("\"rainboy delta is detected\"");

        prev_rating_deltas.sort();

        if (prev_rating_deltas[0] > 0) {
            prev_rating_deltas[0] = - prev_rating_deltas[0];
        }
        if (prev_rating_deltas[COUNT_PREV_CONTEST_DELTA-1] < 0) {
            prev_rating_deltas[COUNT_PREV_CONTEST_DELTA-1] = - prev_rating_deltas[COUNT_PREV_CONTEST_DELTA-1];
        }
        return prev_rating_deltas;
    }


    function PredictRatings(maxRating, currRating, prev_rating_deltas, luckyNumber) {
        var predictedRating = maxRating;
        if (!validate_input(maxRating, currRating, prev_rating_deltas)) {
            return "0 <br> You will be Undated";
        }
        prev_rating_deltas = normalize_deltas(prev_rating_deltas);

        // insert math shit here:


        return predictedRating;
    }   


    function ResetDivs(predictedRatingObj, warningObj, additionalThingsObj) {
        predictedRatingObj.innerHTML = "";
        warningObj.innerHTML = "";
        additionalThingsObj.innerHTML = "";
    }


    function getPredictedRatings() {
        const maxRating = parseInt(document.getElementById("max-rating").value);
        const currRating = parseInt(document.getElementById("curr-rating").value);
        const delta_array_obj = document.getElementsByName("delta-arr");
        const luckyNumber = parseInt(document.getElementById("lucky-number").value);
        const predictedRatingObj = document.getElementById("predicted-ratings");
        const warningObj = document.getElementById("warning-generated");
        const additionalThingsObj = document.getElementById("additional-things");
        var prev_rating_deltas = []
        for (var i = 0; i < delta_array_obj.length; i++) {
            prev_rating_deltas.push(parseInt(delta_array_obj[i].value));
        }
        
        // reset the previous output
        console.log(predictedRatingObj, warningObj, additionalThingsObj);
        ResetDivs(predictedRatingObj, warningObj, additionalThingsObj);
        // input check
        console.log(prev_rating_deltas);
        console.log(maxRating);
        console.log(currRating + maxRating);
        
        var predictedRating = PredictRatings(maxRating, currRating, prev_rating_deltas, luckyNumber);
        
        predictedRatingObj.classList.add('magictime', 'puffIn');
        predictedRatingObj.innerHTML = "Your predicted rating is:<br>"
        predictedRatingObj.innerHTML += "<span class = \"rating-predicted-class\">"+predictedRating+"</span>"; // "ok tested";
        // console.log(predictedRatingObj)

        if (currRank != -1) {
            // add analysis and challenge
        } else {
            // generate error stream
        }

        // remove the animation class for rendering it again without a reload
        setTimeout( () => { 
            // console.log(predictedRatingObj.classList);
            predictedRatingObj.classList.remove('magictime', 'puffIn');
            // console.log(predictedRatingObj.classList);
        }, 1500);
    }
    
</script>
</html>
